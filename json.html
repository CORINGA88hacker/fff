<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador JSON TMDb - Séries e Filmes</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #121212; color: #f1f1f1; }
  label { display: block; margin-top: 10px; }
  input, select, button, textarea { margin-top: 5px; padding: 8px; width: 100%; border-radius: 5px; border: none; }
  button { cursor: pointer; margin-top: 10px; background: #2196F3; color: #fff; }
  button:hover { background: #0b7dda; }
  textarea { height: 400px; font-family: monospace; margin-top: 10px; }
  .row { display: flex; gap: 10px; margin-top: 20px; }
  .row button { flex: 1; }
  #errorMsg { color: red; margin-top: 10px; }
</style>
</head>
<body>

<h2>Gerador JSON TMDb - Séries e Filmes</h2>

<label>TMDb ID:</label>
<input type="text" id="tmdbInput" placeholder="Digite o ID do TMDb">

<label>Ou Nome (busca automática):</label>
<input type="text" id="tmdbNameInput" placeholder="Digite o nome da Série ou Filme">

<label>Idioma:</label>
<select id="languageSelect">
  <option value="pt-BR">Português (Brasil)</option>
  <option value="en-US">Inglês</option>
</select>

<label>Coluna:</label>
<input type="text" id="colunaInput" placeholder="Nome da coluna (ex: Romance, Netflix)">

<div class="row">
  <button type="button" id="btnSerie">Extrair JSON da Série</button>
  <button type="button" id="btnFilme">Extrair JSON do Filme</button>
</div>

<p id="errorMsg"></p>
<textarea id="output" readonly></textarea>

<script>
const apiKey = "COLOQUE_SUA_API_KEY_AQUI"; // Sua TMDb API Key
const tmdbInput = document.getElementById("tmdbInput");
const tmdbNameInput = document.getElementById("tmdbNameInput");
const languageSelect = document.getElementById("languageSelect");
const colunaInput = document.getElementById("colunaInput");
const btnSerie = document.getElementById("btnSerie");
const btnFilme = document.getElementById("btnFilme");
const output = document.getElementById("output");
const errorMsg = document.getElementById("errorMsg");

const statusMap = {
  "Returning Series": "Em exibição",
  "Ended": "Finalizada",
  "Canceled": "Cancelada",
  "Planned": "Planejada",
  "In Production": "Em produção",
  "Released": "Lançado"
};

function mostrarJSON(obj){
  output.value = JSON.stringify(obj,null,2);
  output.select();
}

async function fetchJSON(url){
  const res = await fetch(url,{
    headers:{Authorization:`Bearer ${apiKey}`, "Content-Type":"application/json"}
  });
  if(!res.ok) throw new Error("Erro ao buscar dados da API TMDb");
  return await res.json();
}

async function procurarId(nome, tipo, lang){
  const data = await fetchJSON(`https://api.themoviedb.org/3/search/${tipo}?query=${encodeURIComponent(nome)}&language=${lang}`);
  if(data.results && data.results.length>0) return data.results[0].id;
  throw new Error(`${tipo==="tv"?"Série":"Filme"} não encontrado.`);
}

async function buscarSerie(id, lang){ return await fetchJSON(`https://api.themoviedb.org/3/tv/${id}?language=${lang}`); }
async function buscarFilme(id, lang){ return await fetchJSON(`https://api.themoviedb.org/3/movie/${id}?language=${lang}`); }

async function buscarTrailer(tmdbId,tipo,lang){
  const data = await fetchJSON(`https://api.themoviedb.org/3/${tipo}/${tmdbId}/videos?language=${lang}`);
  const trailer = data.results.find(v=>v.type==="Trailer"&&v.site==="YouTube")||data.results.find(v=>v.type==="Teaser"&&v.site==="YouTube");
  return trailer?`https://www.youtube.com/watch?v=${trailer.key}`:"";
}

async function buscarLogo(tmdbId,tipo){
  const data = await fetchJSON(`https://api.themoviedb.org/3/${tipo}/${tmdbId}/images`);
  const logo = (data.logos && data.logos[0]?.file_path) || (data.poster_path?data.poster_path:"");
  return logo?`https://image.tmdb.org/t/p/w500${logo}`:"";
}

// Série
btnSerie.addEventListener("click",async()=>{
  errorMsg.textContent="";
  output.value="";
  const lang=languageSelect.value;
  const coluna=colunaInput.value.trim();
  try{
    let id = tmdbInput.value.trim();
    const nome = tmdbNameInput.value.trim();
    if(!id && nome) id = await procurarId(nome,"tv",lang);
    if(!id) throw new Error("Digite o ID ou nome da série.");
    const data = await buscarSerie(id,lang);
    const trailerUrl = await buscarTrailer(id,"tv",lang);
    const logoUrl = await buscarLogo(id,"tv");
    const jsonSerie = {
      id: id,
      nome: data.name||"",
      titulo_original: data.original_name||"",
      genero: data.genres?data.genres.map(g=>g.name).join(", "):"",
      descricao: data.overview||"",
      ano: (data.first_air_date||"").slice(0,4),
      status: statusMap[data.status]||data.status||"",
      pais: data.origin_country?.[0]||"",
      duracao_episodio: data.episode_run_time?.[0]?.toString()||"",
      classificacao: data.adult?"18+":"10+",
      popularidade: data.popularity?.toFixed(4)||"",
      trailer: trailerUrl,
      capa: data.poster_path?`https://image.tmdb.org/t/p/w600_and_h900_bestv2${data.poster_path}`:"",
      banner: data.backdrop_path?`https://image.tmdb.org/t/p/w1280${data.backdrop_path}`:"",
      logo: logoUrl,
      thumbnail:"",
      tmdb_id: id,
      imdb_id: await (async()=>{
        const e = await fetchJSON(`https://api.themoviedb.org/3/tv/${id}/external_ids`);
        return e.imdb_id||"";
      })(),
      data_criacao: data.first_air_date?new Date(data.first_air_date).toISOString():"",
      data_atualizacao: new Date().toISOString(),
      coluna: coluna,
      linguagem: data.original_language||"",
      msg: data.tagline||"",
      qualidade:"HD"
    };
    mostrarJSON(jsonSerie);
  }catch(err){errorMsg.textContent=err.message;}
});

// Filme
btnFilme.addEventListener("click",async()=>{
  errorMsg.textContent="";
  output.value="";
  const lang=languageSelect.value;
  const coluna=colunaInput.value.trim();
  try{
    let id = tmdbInput.value.trim();
    const nome = tmdbNameInput.value.trim();
    if(!id && nome) id = await procurarId(nome,"movie",lang);
    if(!id) throw new Error("Digite o ID ou nome do filme.");
    const data = await buscarFilme(id,lang);
    const trailerUrl = await buscarTrailer(id,"movie",lang);
    const logoUrl = await buscarLogo(id,"movie");
    const jsonFilme = {
      id: id,
      nome: data.title||"",
      titulo_original: data.original_title||"",
      genero: data.genres?data.genres.map(g=>g.name).join(", "):"",
      descricao: data.overview||"",
      ano: (data.release_date||"").slice(0,4),
      status: statusMap[data.status]||data.status||"",
      pais: data.production_countries?.[0]?.iso_3166_1||"",
      duracao_episodio: data.runtime?.toString()||"",
      classificacao: data.adult?"18+":"10+",
      popularidade: data.popularity?.toFixed(4)||"",
      trailer: trailerUrl,
      capa: data.poster_path?`https://image.tmdb.org/t/p/w600_and_h900_bestv2${data.poster_path}`:"",
      banner: data.backdrop_path?`https://image.tmdb.org/t/p/w1280${data.backdrop_path}`:"",
      logo: logoUrl,
      thumbnail:"",
      tmdb_id: id,
      imdb_id: data.imdb_id||"",
      data_criacao: data.release_date?new Date(data.release_date).toISOString():"",
      data_atualizacao: new Date().toISOString(),
      coluna: coluna,
      linguagem: data.original_language||"",
      msg: data.tagline||"",
      qualidade:"HD"
    };
    mostrarJSON(jsonFilme);
  }catch(err){errorMsg.textContent=err.message;}
});
</script>

</body>
</html>
