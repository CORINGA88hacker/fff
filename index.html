<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lista de Animes - Super Netflix</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Open Sans', sans-serif;
        background-color: #141414;
        color: #fff;
        margin: 0;
    }
    header {
        text-align: center;
        padding: 20px;
        background: linear-gradient(to bottom, #000, transparent);
    }
    header h1 {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 48px;
        letter-spacing: 2px;
        color: #e50914;
    }
    #search-container {
        text-align: center;
        margin: 20px;
    }
    #search-input {
        padding: 10px;
        font-size: 16px;
        width: 250px;
        border: none;
        border-radius: 4px;
    }
    button {
        padding: 10px 15px;
        font-size: 16px;
        margin-left: 5px;
        cursor: pointer;
        background-color: #e50914;
        color: #fff;
        border: none;
        border-radius: 4px;
        transition: 0.3s;
    }
    button:hover {
        background-color: #f40612;
    }
    #counter {
        text-align: center;
        margin-bottom: 20px;
        font-size: 18px;
        font-weight: bold;
    }
    #loading {
        text-align: center;
        font-size: 18px;
        padding: 20px;
    }
    .anime-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 15px;
        padding: 20px;
    }
    .anime-card {
        background-color: #181818;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .anime-card:hover {
        transform: scale(1.08);
        box-shadow: 0px 0px 20px rgba(255, 0, 0, 0.5);
    }
    .anime-card img {
        width: 100%;
        height: 270px;
        object-fit: cover;
    }
    .anime-card h3 {
        font-size: 18px;
        margin: 10px;
        font-family: 'Bebas Neue', sans-serif;
        color: #fff;
    }
    .anime-card p {
        font-size: 13px;
        margin: 5px 10px;
        color: #aaa;
    }

    /* Dialog */
    dialog {
        background-color: #181818;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 20px;
        width: 90%;
        max-width: 800px;
    }
    dialog::backdrop {
        background: rgba(0,0,0,0.85);
    }
    #dialog-header {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }
    #dialog-header img {
        width: 200px;
        border-radius: 5px;
    }
    #dialog-info {
        flex: 1;
    }
    #dialog-info h2 {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 30px;
        color: #e50914;
        margin: 0;
    }
    #dialog-info p {
        color: #ddd;
        font-size: 14px;
        margin-top: 8px;
    }
    #episode-list {
        margin-top: 20px;
        list-style: none;
        padding: 0;
    }
    #episode-list li {
        padding: 8px;
        background: #222;
        margin-bottom: 5px;
        border-radius: 4px;
    }
    #episode-list li a {
        color: #fff;
        text-decoration: none;
    }
    #episode-list li a:hover {
        text-decoration: underline;
    }
    form[method="dialog"] {
        margin-top: 15px;
        text-align: right;
    }
</style>
</head>
<body>
<header>
    <h1>Lista de Animes</h1>
</header>

<section id="search-container">
    <input type="text" id="search-input" placeholder="Pesquisar por ID do anime...">
    <button id="search-btn">Buscar</button>
    <button id="clear-btn">Limpar</button>
</section>

<div id="counter"></div>
<div id="loading">Carregando animes...</div>
<section id="anime-list" class="anime-list"></section>

<dialog id="anime-dialog">
    <div id="dialog-header">
        <img id="dialog-capa" src="" alt="Capa">
        <div id="dialog-info">
            <h2 id="modal-title"></h2>
            <p id="modal-desc"></p>
            <p id="modal-year"></p>
            <p id="modal-ep-count"></p>
        </div>
    </div>
    <ul id="episode-list"></ul>
    <form method="dialog">
        <button>Fechar</button>
    </form>
</dialog>

<script>
const animeListEl = document.getElementById('anime-list');
const counterEl = document.getElementById('counter');
const loadingEl = document.getElementById('loading');
const searchInput = document.getElementById('search-input');
const searchBtn = document.getElementById('search-btn');
const clearBtn = document.getElementById('clear-btn');
const dialog = document.getElementById('anime-dialog');
const modalTitle = document.getElementById('modal-title');
const modalDesc = document.getElementById('modal-desc');
const modalYear = document.getElementById('modal-year');
const modalEpCount = document.getElementById('modal-ep-count');
const dialogCapa = document.getElementById('dialog-capa');
const episodeList = document.getElementById('episode-list');

let temporadas = [];
let episodios = [];

async function carregarDados() {
    try {
        loadingEl.style.display = 'block';
        animeListEl.innerHTML = '';
        counterEl.textContent = '';

        const [tempRes, epiRes] = await Promise.all([
            fetch('https://anime-aniverso.vercel.app/temporadas.json'),
            fetch('https://anime-aniverso.vercel.app/episodios.json')
        ]);

        temporadas = await tempRes.json();
        episodios = await epiRes.json();

        temporadas = temporadas.map(temp => {
            const eps = episodios.filter(ep => String(ep.temporada_id) === String(temp.id));
            return {
                ...temp,
                totalEpisodios: eps.length,
                episodios: eps
            };
        });

        exibirAnimes(temporadas);
    } catch (err) {
        console.error('Erro ao carregar dados:', err);
        animeListEl.innerHTML = '<p>Erro ao carregar os dados.</p>';
    } finally {
        loadingEl.style.display = 'none';
    }
}

function exibirAnimes(lista) {
    animeListEl.innerHTML = '';

    lista.forEach(anime => {
        const card = document.createElement('div');
        card.className = 'anime-card';
        card.innerHTML = `
            <img src="${anime.capa || 'https://via.placeholder.com/200x300?text=Sem+Capa'}" alt="${anime.nome}">
            <h3>${anime.nome}</h3>
            <p>ID: ${anime.id}</p>
            <p>${anime.ano || 'Ano desconhecido'}</p>
        `;
        card.addEventListener('click', () => abrirDialogo(anime));
        animeListEl.appendChild(card);
    });

    counterEl.textContent = `Total: ${lista.length} animes`;
}

function abrirDialogo(anime) {
    modalTitle.textContent = anime.nome;
    modalDesc.textContent = anime.descricao || 'Sem descrição disponível';
    modalYear.textContent = `Ano: ${anime.ano || 'Desconhecido'}`;
    modalEpCount.textContent = `Episódios: ${anime.totalEpisodios}`;
    dialogCapa.src = anime.capa || 'https://via.placeholder.com/200x300?text=Sem+Capa';

    episodeList.innerHTML = '';
    if (anime.episodios.length === 0) {
        episodeList.innerHTML = '<li>Sem episódios disponíveis</li>';
    } else {
        anime.episodios.forEach(ep => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="${ep.link}" target="_blank">${ep.nome || 'Episódio sem título'}</a>`;
            episodeList.appendChild(li);
        });
    }
    dialog.showModal();
}

searchBtn.addEventListener('click', () => {
    const termo = searchInput.value.trim();
    if (!termo) return;
    const resultado = temporadas.filter(anime => String(anime.id) === termo);
    exibirAnimes(resultado);
});

clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    exibirAnimes(temporadas);
});

carregarDados();
</script>
</body>
</html>
