<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador JSON TMDb</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #121212; color: #f1f1f1; }
    label { display: block; margin-top: 10px; }
    input, select, button, textarea { margin-top: 5px; padding: 8px; width: 100%; border-radius: 5px; border: none; }
    button { cursor: pointer; margin-top: 10px; background: #2196F3; color: #fff; }
    button:hover { background: #0b7dda; }
    textarea { height: 400px; font-family: monospace; }
    .row { display: flex; gap: 10px; margin-top: 20px; }
    .row button { flex: 1; }
    #errorMsg { color: red; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Gerador JSON - TMDb (Séries & Filmes)</h2>

  <label>TMDb ID:</label>
  <input type="text" id="tmdbInput" placeholder="Digite o ID do TMDb">

  <label>Ou Nome (busca automática):</label>
  <input type="text" id="tmdbNameInput" placeholder="Digite o nome da Série ou Filme">

  <label>Idioma:</label>
  <select id="languageSelect">
    <option value="pt-BR">Português (Brasil)</option>
    <option value="en-US">Inglês</option>
  </select>

  <label>Coluna:</label>
  <input type="text" id="colunaInput" placeholder="Nome da coluna (ex: netflix, hbo)">

  <div class="row">
    <button type="button" id="btnSerie">Extrair JSON da Série</button>
    <button type="button" id="btnFilme">Extrair JSON do Filme</button>
  </div>

  <p id="errorMsg"></p>
  <textarea id="output" readonly></textarea>

  <script>
    const apiKey = "SUA_API_KEY_TMDB_AQUI"; // coloque sua TMDb API Key
    const tmdbInput = document.getElementById("tmdbInput");
    const tmdbNameInput = document.getElementById("tmdbNameInput");
    const languageSelect = document.getElementById("languageSelect");
    const colunaInput = document.getElementById("colunaInput");
    const btnSerie = document.getElementById("btnSerie");
    const btnFilme = document.getElementById("btnFilme");
    const output = document.getElementById("output");
    const errorMsg = document.getElementById("errorMsg");

    const statusMap = {
      "Returning Series": "Em exibição",
      "Ended": "Finalizada",
      "Canceled": "Cancelada",
      "Planned": "Planejada",
      "In Production": "Em produção",
      "Released": "Lançado"
    };

    function traduzirGeneros(genres) {
      if (!genres) return [];
      return genres.map(g => g.name);
    }

    function traduzirClassificacao(adult) {
      return adult ? "18+" : "Livre";
    }

    async function fetchJSON(url) {
      const res = await fetch(url, { headers: { Authorization: `Bearer ${apiKey}`, "Content-Type": "application/json" }});
      if (!res.ok) throw new Error("Erro ao buscar dados da API TMDb");
      return await res.json();
    }

    async function buscarSerie(id, lang) {
      return await fetchJSON(`https://api.themoviedb.org/3/tv/${id}?language=${lang}`);
    }

    async function buscarFilme(id, lang) {
      return await fetchJSON(`https://api.themoviedb.org/3/movie/${id}?language=${lang}`);
    }

    async function procurarId(nome, tipo, lang) {
      const url = `https://api.themoviedb.org/3/search/${tipo}?query=${encodeURIComponent(nome)}&language=${lang}`;
      const data = await fetchJSON(url);
      if (data.results && data.results.length > 0) return data.results[0].id;
      throw new Error(`${tipo === "tv" ? "Série" : "Filme"} não encontrado.`);
    }

    function mostrarJSON(obj) {
      output.textContent = JSON.stringify(obj, null, 2);
      output.select();
    }

    // Série
    btnSerie.addEventListener("click", async () => {
      errorMsg.textContent = "";
      output.textContent = "";
      const lang = languageSelect.value;
      const coluna = colunaInput.value.trim();
      try {
        let id = tmdbInput.value.trim();
        const nome = tmdbNameInput.value.trim();
        if (!id && nome) id = await procurarId(nome, "tv", lang);
        if (!id) throw new Error("Digite o ID ou nome da série.");
        const data = await buscarSerie(id, lang);
        const jsonSerie = {
          id: id,
          nome: data.name || "",
          titulo_original: data.original_name || "",
          genero: traduzirGeneros(data.genres),
          descricao: data.overview || "",
          ano: (data.first_air_date || "").slice(0,4),
          status: statusMap[data.status] || data.status || "",
          pais: data.origin_country?.[0] || "",
          temporadas: data.number_of_seasons || 0,
          episodios: data.number_of_episodes || 0,
          classificacao: traduzirClassificacao(data.adult),
          popularidade: data.popularity?.toFixed(4) || "",
          capa: data.poster_path ? `https://image.tmdb.org/t/p/w600_and_h900_bestv2${data.poster_path}` : "",
          banner: data.backdrop_path ? `https://image.tmdb.org/t/p/w1280${data.backdrop_path}` : "",
          tmdb_id: id,
          data_criacao: data.first_air_date || "",
          data_atualizacao: new Date().toISOString(),
          coluna: coluna,
          linguagem: data.original_language || "",
          qualidade: "HD"
        };
        mostrarJSON(jsonSerie);
      } catch(err) { errorMsg.textContent = err.message; }
    });

    // Filme
    btnFilme.addEventListener("click", async () => {
      errorMsg.textContent = "";
      output.textContent = "";
      const lang = languageSelect.value;
      const coluna = colunaInput.value.trim();
      try {
        let id = tmdbInput.value.trim();
        const nome = tmdbNameInput.value.trim();
        if (!id && nome) id = await procurarId(nome, "movie", lang);
        if (!id) throw new Error("Digite o ID ou nome do filme.");
        const data = await buscarFilme(id, lang);
        const jsonFilme = {
          id: id,
          nome: data.title || "",
          titulo_original: data.original_title || "",
          genero: traduzirGeneros(data.genres),
          descricao: data.overview || "",
          ano: (data.release_date || "").slice(0,4),
          status: statusMap[data.status] || data.status || "",
          pais: data.origin_country?.[0] || "",
          duracao: data.runtime?.toString() || "",
          classificacao: traduzirClassificacao(data.adult),
          popularidade: data.popularity?.toFixed(4) || "",
          capa: data.poster_path ? `https://image.tmdb.org/t/p/w600_and_h900_bestv2${data.poster_path}` : "",
          banner: data.backdrop_path ? `https://image.tmdb.org/t/p/w1280${data.backdrop_path}` : "",
          tmdb_id: id,
          imdb_id: data.imdb_id || "",
          data_criacao: data.release_date || "",
          data_atualizacao: new Date().toISOString(),
          coluna: coluna,
          linguagem: data.original_language || "",
          qualidade: "HD"
        };
        mostrarJSON(jsonFilme);
      } catch(err) { errorMsg.textContent = err.message; }
    });
  </script>
</body>
</html>
